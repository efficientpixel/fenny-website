/*!
 * ExpressionEngine - by EllisLab
 *
 * @package		ExpressionEngine
 * @author		EllisLab Dev Team
 * @copyright	Copyright (c) 2003 - 2015, EllisLab, Inc.
 * @license		http://ellislab.com/expressionengine/user-guide/license.html
 * @link		http://ellislab.com
 * @since		Version 2.0
 * @filesource
 */
$.ee_filemanager=$.filemanager||{},$(document).ready(function(){$.ee_filemanager.file_uploader(),$.ee_filemanager.datatables(),$.ee_filemanager.image_overlay(),$.ee_filemanager.date_range(),$.ee_filemanager.toggle_all(),$.ee_filemanager.directory_change(),$(".paginationLinks .first").hide(),$(".paginationLinks .previous").hide()}),$.ee_filemanager.file_uploader=function(){$.ee_fileuploader({type:"filemanager",load:function(){$.template("filemanager_row",$("#filemanager_row").remove())},open:function(){$.ee_fileuploader.set_directory_id($("#dir_id").val())},after_upload:function(e,a){if(1==a.replace&&$(".mainTable tbody tr:has(td:contains("+a.file_id+")):has(td:contains("+a.file_name+"))").remove(),a.actions="",$.each(EE.fileuploader.actions,function(e,t){var n=t.replace("[file_id]",a.file_id).replace("[upload_dir]",a.upload_directory_prefs.id);"delete"==e?a.action_delete=n:("image"!=e||a.is_image)&&(a.actions+=n+"&nbsp;&nbsp;")}),"undefined"==typeof a.title&&(a.title=a.name),a.is_image){var t=new Date,n=$("<a>",{id:"",href:a.upload_directory_prefs.url+a.file_name+"?v="+t.getTime(),title:a.file_name,text:a.title,rel:"#overlay","class":"less_important_link overlay"});a.link=n.wrap("<div>").parent().html()}else a.link=a.title;$(".mainTable tbody").prepend($.tmpl("filemanager_row",a)),$("td.dataTables_empty").size()&&$("td.dataTables_empty").parent().remove(),1!=a.replace&&$("#file_uploader").dialog("option","position","center"),$(".mainTable").show(),$(".mainTable").table("clear_cache")},trigger:"#action_nav a.upload_file"})},$.ee_filemanager.directory_change=function(){function e(e){void 0===a[e]&&(e=0),jQuery.each(a[e],function(e,a){$("select#cat_id").empty().append(a)})}var a=EE.file.directoryInfo,t=new RegExp("!-!","g");$.each(a,function(e,n){$.each(n,function(n,i){var o=new String;$.each(i,function(e,a){o+='<option value="'+a[0]+'">'+a[1].replace(t,String.fromCharCode(160))+"</option>"}),a[e][n]=o})}),$("#dir_id").change(function(){e(this.value)})},$.ee_filemanager.date_range=function(){function e(){"yyyy-mm-dd"!=$("#custom_date_start").val()&&"yyyy-mm-dd"!=$("#custom_date_end").val()&&(focus_number=$("#date_range").children().length,$("#date_range").append('<option id="custom_date_option">'+$("#custom_date_start").val()+" to "+$("#custom_date_end").val()+"</option>"),document.getElementById("date_range").options[focus_number].selected=!0,$("#custom_date_picker").slideUp("fast"),$("#date_range").change())}$("#custom_date_start_span").datepicker({dateFormat:"yy-mm-dd",prevText:"<<",nextText:">>",onSelect:function(a){$("#custom_date_start").val(a),e()}}),$("#custom_date_end_span").datepicker({dateFormat:"yy-mm-dd",prevText:"<<",nextText:">>",onSelect:function(a){$("#custom_date_end").val(a),e()}}),$("#custom_date_start, #custom_date_end").focus(function(){"yyyy-mm-dd"==$(this).val()&&$(this).val("")}),$("#custom_date_start, #custom_date_end").keypress(function(){$(this).val().length>=9&&e()}),$("#date_range").change(function(){"custom_date"==$("#date_range").val()?($("#custom_date_start").val("yyyy-mm-dd"),$("#custom_date_end").val("yyyy-mm-dd"),$("#custom_date_option").remove(),$("#custom_date_picker").slideDown("fast")):$("#custom_date_picker").hide()})},$.ee_filemanager.image_overlay=function(){function e(){return $("#overlay").hide().removeData("overlay"),$("#overlay .contentWrap img").remove(),$("<img />").appendTo("#overlay .contentWrap").load(function(){var e=$(this).clone().appendTo(document.body).show(),a=e.width(),t=e.height(),n=.8*$(window).width(),i=.8*$(window).height(),o=n/a,r=i/t,d=o>r?r:o;e.remove(),1>d&&(t*=d,a*=d,$(this).height(t).width(a)),$("#overlay").overlay({load:!0,speed:100,top:"center"})}).attr("src",$(this).attr("href")),!1}$("a.overlay").live("click",e),$("#overlay").css("cursor","pointer").click(function(){$(this).fadeOut(100)})},$.ee_filemanager.datatables=function(){$(".mainTable").table("add_filter",$("#filterform"))};